{% extends "base/base.html" %}

{% block content %}
<div class="container py-4" style="max-width: 1200px;">
  <div class="d-flex align-items-center justify-content-between mb-3">
    <div>
      <h3 class="mb-1">Modelos de acceso</h3>
      <div class="text-muted">Perfiles reutilizables que pre-cargan el wizard de solicitudes.</div>
    </div>
    <a class="btn btn-primary" href="{% url 'catalog:template_wizard_start' %}">
      <i class="bi bi-plus-circle me-1"></i>
      Nuevo modelo
    </a>
  </div>

  <!-- Filtros -->
  <form method="get" class="card shadow-sm mb-3">
    <div class="card-body py-3">
      <div class="row g-2 align-items-end">
        <div class="col-md-6">
          <label class="form-label small mb-1">Buscar</label>
          <input type="text" class="form-control"
                 name="q"
                 value="{{ q|default:'' }}"
                 placeholder="Nombre, rol o departamento">
        </div>
        <div class="col-md-3">
          <label class="form-label small mb-1">Departamento</label>
          <input type="text" class="form-control"
                 name="department"
                 value="{{ department|default:'' }}"
                 placeholder="Filtrar por departamento">
        </div>
        <div class="col-md-3 d-flex gap-2">
          <button class="btn btn-outline-primary w-100" type="submit">Filtrar</button>
          <a class="btn btn-outline-secondary" href="{% url 'catalog:template_list' %}">Limpiar</a>
        </div>
      </div>
    </div>
  </form>

  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover align-middle mb-0">
          <thead class="table-light">
            <tr>
              <th>#</th>
              <th>Nombre</th>
              <th>Departamento</th>
              <th>Rol / Puesto</th>
              <th style="width: 90px;">Empresas</th>
              <th style="width: 190px;">Creado</th>
              <th style="width: 180px;"></th>
            </tr>
          </thead>
          <tbody>
            {% for t in templates %}
              <tr>
                <td class="text-muted">{{ t.id }}</td>
                <td>
                  <div class="fw-semibold">{{ t.name }}</div>
                  {% if t.notes %}
                    <div class="text-muted small">{{ t.notes|truncatechars:60 }}</div>
                  {% endif %}
                </td>
                <td class="text-muted">{{ t.department|default:"—" }}</td>
                <td class="text-muted">{{ t.role_name|default:"—" }}</td>
                <td class="text-center text-muted">{{ t.items.count }}</td>
                <td class="text-muted small">{{ t.created_at|date:"d/m/Y H:i" }}</td>
                <td class="text-end pe-3">
                  <a class="btn btn-sm btn-outline-secondary"
                     href="{% url 'catalog:template_detail' t.pk %}">
                    <i class="bi bi-eye me-1"></i>Ver
                  </a>
                  <a class="btn btn-sm btn-outline-primary"
                     href="{% url 'catalog:template_edit' t.pk %}">
                    <i class="bi bi-pencil me-1"></i>Editar
                  </a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="7" class="text-center text-muted py-4">
                  No hay modelos de acceso.
                  <a href="{% url 'catalog:template_wizard_start' %}">Crear el primero</a>.
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Paginación -->
  {% if is_paginated %}
    <nav class="mt-3">
      <ul class="pagination pagination-sm justify-content-center">
        {% if page_obj.has_previous %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.previous_page_number }}&q={{ q }}&department={{ department }}">‹</a>
          </li>
        {% endif %}
        <li class="page-item disabled">
          <span class="page-link">{{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
        </li>
        {% if page_obj.has_next %}
          <li class="page-item">
            <a class="page-link" href="?page={{ page_obj.next_page_number }}&q={{ q }}&department={{ department }}">›</a>
          </li>
        {% endif %}
      </ul>
    </nav>
  {% endif %}

</div>
{% endblock %}
